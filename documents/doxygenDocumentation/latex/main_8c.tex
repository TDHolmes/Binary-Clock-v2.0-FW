\hypertarget{main_8c}{}\section{firmware/main.c File Reference}
\label{main_8c}\index{firmware/main.\+c@{firmware/main.\+c}}


Main logic of the Binary Clock firmware. Handles calling all other functions other than interrupt driven I\+S\+Rs.  


{\ttfamily \#include $<$avr/io.\+h$>$}\newline
{\ttfamily \#include \char`\"{}timer\+\_\+4313.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}R\+T\+C\+\_\+\+D\+S3231.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}L\+E\+D.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}U\+A\+R\+T.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}i2c.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}hardware.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}color.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}ports.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}global\+\_\+defines.\+h\char`\"{}}\newline
{\ttfamily \#include $<$stdint.\+h$>$}\newline
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{main_8c_ad3fcfed0b340c80205d17572a9d1f5c8}{}\label{main_8c_ad3fcfed0b340c80205d17572a9d1f5c8} 
\#define \hyperlink{main_8c_ad3fcfed0b340c80205d17572a9d1f5c8}{N\+O\+\_\+\+F\+O\+R\+C\+E\+\_\+\+U\+P\+D\+A\+TE}~0
\begin{DoxyCompactList}\small\item\em Only update the L\+ED array columns that have changed. \end{DoxyCompactList}\item 
\hypertarget{main_8c_a986b9ffaa07e690ab7d2731405337319}{}\label{main_8c_a986b9ffaa07e690ab7d2731405337319} 
\#define \hyperlink{main_8c_a986b9ffaa07e690ab7d2731405337319}{F\+O\+R\+C\+E\+\_\+\+U\+P\+D\+A\+TE}~1
\begin{DoxyCompactList}\small\item\em Update all L\+ED array columns. \end{DoxyCompactList}\item 
\hypertarget{main_8c_a73c52f3e083ffd8acde0b01f74de7a5a}{}\label{main_8c_a73c52f3e083ffd8acde0b01f74de7a5a} 
\#define \hyperlink{main_8c_a73c52f3e083ffd8acde0b01f74de7a5a}{C\+O\+M\+M\+A\+N\+D\+\_\+\+L\+E\+N\+G\+TH}~6
\begin{DoxyCompactList}\small\item\em number of bytes in a valid U\+A\+RT command. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248}{state\+\_\+t} \{ \hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248a3a35b5637ac389462359c30abbfbf405}{R\+U\+N\+\_\+\+T\+I\+ME}, 
\hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248a0db6a15af5dfe805b3670bd7b0cc79aa}{R\+U\+N\+\_\+\+M\+A\+N\+U\+AL}
 \}\begin{DoxyCompactList}\small\item\em Current state of the clock. \end{DoxyCompactList}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{main_8c_ab7ca1d7f6e3e0aa50018c99ecface556}{}\label{main_8c_ab7ca1d7f6e3e0aa50018c99ecface556} 
\hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248}{state\+\_\+t} \hyperlink{main_8c_ab7ca1d7f6e3e0aa50018c99ecface556}{system\+\_\+state} = \hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248a3a35b5637ac389462359c30abbfbf405}{R\+U\+N\+\_\+\+T\+I\+ME}
\begin{DoxyCompactList}\small\item\em keeps track of the system state. \end{DoxyCompactList}\item 
\hypertarget{main_8c_ac7e20580a719e05c4636488e9be3f416}{}\label{main_8c_ac7e20580a719e05c4636488e9be3f416} 
uint8\+\_\+t \hyperlink{main_8c_ac7e20580a719e05c4636488e9be3f416}{uart\+\_\+command\+\_\+received} = 0
\begin{DoxyCompactList}\small\item\em valid command received flag. \end{DoxyCompactList}\item 
\hypertarget{main_8c_a5cfb334a7bf0f4b5c337f27520190abe}{}\label{main_8c_a5cfb334a7bf0f4b5c337f27520190abe} 
uint8\+\_\+t \hyperlink{main_8c_a5cfb334a7bf0f4b5c337f27520190abe}{timer\+\_\+expired} = 0
\begin{DoxyCompactList}\small\item\em 15-\/20ish ms timer timeout flag. \end{DoxyCompactList}\item 
\hypertarget{main_8c_a6e5ffe07d12493f339d4be9454ef2a2b}{}\label{main_8c_a6e5ffe07d12493f339d4be9454ef2a2b} 
uint8\+\_\+t \hyperlink{main_8c_a6e5ffe07d12493f339d4be9454ef2a2b}{L\+E\+D\+\_\+multiplex\+\_\+timer\+\_\+count} = 0
\begin{DoxyCompactList}\small\item\em count of mutiplex handler timer events. \end{DoxyCompactList}\item 
\hypertarget{main_8c_a7b552a5dffd6c6e5ff11caac286ba3de}{}\label{main_8c_a7b552a5dffd6c6e5ff11caac286ba3de} 
uint8\+\_\+t \hyperlink{main_8c_a7b552a5dffd6c6e5ff11caac286ba3de}{command\+\_\+buffer} \mbox{[}\hyperlink{main_8c_a73c52f3e083ffd8acde0b01f74de7a5a}{C\+O\+M\+M\+A\+N\+D\+\_\+\+L\+E\+N\+G\+TH}\mbox{]}
\begin{DoxyCompactList}\small\item\em where U\+A\+RT commands are buffered. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Main logic of the Binary Clock firmware. Handles calling all other functions other than interrupt driven I\+S\+Rs. 



\subsection{Enumeration Type Documentation}
\hypertarget{main_8c_aa0aafed44fec19806d8f9ad834be1248}{}\label{main_8c_aa0aafed44fec19806d8f9ad834be1248} 
\index{main.\+c@{main.\+c}!state\+\_\+t@{state\+\_\+t}}
\index{state\+\_\+t@{state\+\_\+t}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{state\+\_\+t}{state\_t}}
{\footnotesize\ttfamily enum \hyperlink{main_8c_aa0aafed44fec19806d8f9ad834be1248}{state\+\_\+t}}



Current state of the clock. 

\begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{R\+U\+N\+\_\+\+T\+I\+ME@{R\+U\+N\+\_\+\+T\+I\+ME}!main.\+c@{main.\+c}}\index{main.\+c@{main.\+c}!R\+U\+N\+\_\+\+T\+I\+ME@{R\+U\+N\+\_\+\+T\+I\+ME}}}\hypertarget{main_8c_aa0aafed44fec19806d8f9ad834be1248a3a35b5637ac389462359c30abbfbf405}{}\label{main_8c_aa0aafed44fec19806d8f9ad834be1248a3a35b5637ac389462359c30abbfbf405} 
R\+U\+N\+\_\+\+T\+I\+ME&Runs time display mode. L\+E\+Ds controlled by the current time. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{R\+U\+N\+\_\+\+M\+A\+N\+U\+AL@{R\+U\+N\+\_\+\+M\+A\+N\+U\+AL}!main.\+c@{main.\+c}}\index{main.\+c@{main.\+c}!R\+U\+N\+\_\+\+M\+A\+N\+U\+AL@{R\+U\+N\+\_\+\+M\+A\+N\+U\+AL}}}\hypertarget{main_8c_aa0aafed44fec19806d8f9ad834be1248a0db6a15af5dfe805b3670bd7b0cc79aa}{}\label{main_8c_aa0aafed44fec19806d8f9ad834be1248a0db6a15af5dfe805b3670bd7b0cc79aa} 
R\+U\+N\+\_\+\+M\+A\+N\+U\+AL&Runs manual display mode. L\+E\+Ds controlled by U\+A\+RT commands. \\
\hline

\end{DoxyEnumFields}


\subsection{Function Documentation}
\hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{}\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe} 
\index{main.\+c@{main.\+c}!main@{main}}
\index{main@{main}!main.\+c@{main.\+c}}
\subsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily int main (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Runs the main program.

Order of opperation\+:
\begin{DoxyEnumerate}
\item Check if we\textquotesingle{}ve received enough data for a command.
\begin{DoxyItemize}
\item If we have, process it.
\end{DoxyItemize}
\item Check if we should run manual control or time control.
\begin{DoxyItemize}
\item If manual control\+: a. run the L\+ED multiplex function. b. keep time as well.
\item If time control\+: a. check if we need to update the time
\begin{DoxyItemize}
\item if so, increment time and update the L\+ED array b. run the L\+ED multiplex function 
\end{DoxyItemize}
\end{DoxyItemize}
\end{DoxyEnumerate}